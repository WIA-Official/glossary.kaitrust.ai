/**
 * KAITRUST Site Kit - Unified Component Loader
 * Version: 1.0.0
 *
 * Automatically loads and initializes all KAITRUST components:
 * - Mobile Navigation (Hamburger Menu)
 * - Accessibility (ARIA, Skip Links)
 * - Ask AI Modal
 * - Language Modal (211 languages)
 * - SEO Enhancements
 *
 * Usage: Add before </body>
 * <script src="/components/site-kit/kaitrust-site-kit.js"></script>
 */

(function() {
    'use strict';

    const VERSION = '1.0.0';
    const BASE_PATH = '/components';

    // Components to load
    const COMPONENTS = [
        { name: 'a11y', js: '/a11y/kaitrust-a11y.js', priority: 1 },
        { name: 'mobile-nav', js: '/mobile-nav/kaitrust-mobile-nav.js', css: '/mobile-nav/kaitrust-mobile-nav.css', priority: 2 },
        { name: 'ask-ai', js: '/ask-ai/kaitrust-ai-modal.js', css: '/ask-ai/kaitrust-ai-modal.css', priority: 3 },
        { name: 'language-modal', js: '/language-modal/kaitrust-language-modal.js', css: '/language-modal/kaitrust-language-modal.css', priority: 4 }
    ];

    // SEO Data for each site
    const SEO_DATA = {
        'kaitrust.ai': {
            title: 'AI ê¸°ë³¸ë²• ì „ë¬¸ê¸°ê´€ | KAITRUST í•œêµ­ì¸ê³µì§€ëŠ¥ì§„í¥í˜‘íšŒ',
            description: '2026ë…„ ì‹œí–‰ ì¸ê³µì§€ëŠ¥ê¸°ë³¸ë²• ê³µì‹ ëŒ€ì‘. ê³ ìœ„í—˜AI íŒë³„, AIì˜í–¥í‰ê°€, ì „ë¬¸ìœ„ì› ìƒë‹´. í•œêµ­ì¸ê³µì§€ëŠ¥ì§„í¥í˜‘íšŒ',
            keywords: 'AIê¸°ë³¸ë²•,ì¸ê³µì§€ëŠ¥ê¸°ë³¸ë²•,ê³ ìœ„í—˜AI,AIì˜í–¥í‰ê°€,AIì»´í”Œë¼ì´ì–¸ìŠ¤,KAITRUST',
            image: 'https://kaitrust.ai/og-image.png',
            themeColor: '#3b82f6'
        },
        'check.kaitrust.ai': {
            title: 'ê³ ìœ„í—˜ AI íŒë³„ê¸° | KAITRUST',
            description: 'ë‚´ AIê°€ ê³ ìœ„í—˜ì¸ì§€ 10ì´ˆ ë¬´ë£Œ ì§„ë‹¨! AIê¸°ë³¸ë²• ì œ27ì¡° ê¸°ì¤€ ì²´í¬. ì¦‰ì‹œ ê²°ê³¼ í™•ì¸.',
            keywords: 'ê³ ìœ„í—˜AI,AIìžê°€ì§„ë‹¨,AIìœ„í—˜í‰ê°€,AIê¸°ë³¸ë²•',
            themeColor: '#ef4444'
        },
        'impact.kaitrust.ai': {
            title: 'AI ì˜í–¥í‰ê°€ ì‹œë®¬ë ˆì´í„° | KAITRUST',
            description: 'AIê¸°ë³¸ë²• ì˜ë¬´ ì˜í–¥í‰ê°€ë¥¼ ë¯¸ë¦¬ ì²´í—˜! ë¬´ë£Œ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ ì¤€ë¹„í•˜ì„¸ìš”.',
            keywords: 'AIì˜í–¥í‰ê°€,AIê¸°ë³¸ë²•,ì˜í–¥í‰ê°€ì‹œë®¬ë ˆì´í„°',
            themeColor: '#8b5cf6'
        },
        'glossary.kaitrust.ai': {
            title: 'AI ë°±ê³¼ì‚¬ì „ - 1000+ ìš©ì–´ | KAITRUST',
            description: 'AI ê¸°ë³¸ë²• í•µì‹¬ ìš©ì–´ ì´ì •ë¦¬. ì‰¬ìš´ í•´ì„¤ê³¼ ì‹¤ë¬´ ì˜ˆì‹œ. 211ê°œ ì–¸ì–´ ì§€ì›.',
            keywords: 'AIìš©ì–´,AIë°±ê³¼,ì¸ê³µì§€ëŠ¥ìš©ì–´,AIì‚¬ì „',
            themeColor: '#14b8a6'
        },
        'expert.kaitrust.ai': {
            title: 'AI ì»´í”Œë¼ì´ì–¸ìŠ¤ ì „ë¬¸ìœ„ì› ëª¨ì§‘ | KAITRUST',
            description: 'AI ì „ë¬¸ê°€ ì—¬ëŸ¬ë¶„ì„ ëª¨ì‹­ë‹ˆë‹¤. KAITRUST ì¸ì¦ ì „ë¬¸ìœ„ì›ìœ¼ë¡œ í™œë™í•˜ì„¸ìš”.',
            keywords: 'AIì „ë¬¸ê°€,AIì»´í”Œë¼ì´ì–¸ìŠ¤,ì „ë¬¸ìœ„ì›ëª¨ì§‘',
            themeColor: '#f59e0b'
        },
        'law.kaitrust.ai': {
            title: 'AI ê¸°ë³¸ë²• í¬í„¸ | KAITRUST',
            description: 'ì¸ê³µì§€ëŠ¥ê¸°ë³¸ë²• ì „ë¬¸, ì‹œí–‰ë ¹, í•´ì„¤. ìµœì‹  ê°œì • ë‚´ìš© ì‹¤ì‹œê°„ ë°˜ì˜.',
            keywords: 'AIê¸°ë³¸ë²•,ì¸ê³µì§€ëŠ¥ê¸°ë³¸ë²•,AIë²•ë¥ ',
            themeColor: '#6366f1'
        },
        'compliance.kaitrust.ai': {
            title: 'AI ì»´í”Œë¼ì´ì–¸ìŠ¤ ì²´í¬ë¦¬ìŠ¤íŠ¸ | KAITRUST',
            description: 'AIê¸°ë³¸ë²• ì¤€ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸. ê¸°ì—…ë³„ ë§žì¶¤ ê°€ì´ë“œ ì œê³µ.',
            keywords: 'AIì»´í”Œë¼ì´ì–¸ìŠ¤,AIê·œì œì¤€ìˆ˜,ì²´í¬ë¦¬ìŠ¤íŠ¸',
            themeColor: '#22c55e'
        },
        'dashboard.kaitrust.ai': {
            title: 'AI ì»´í”Œë¼ì´ì–¸ìŠ¤ ëŒ€ì‹œë³´ë“œ | KAITRUST',
            description: 'AI ê·œì œ ì¤€ìˆ˜ í˜„í™©ì„ í•œëˆˆì—. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ.',
            keywords: 'AIëŒ€ì‹œë³´ë“œ,ì»´í”Œë¼ì´ì–¸ìŠ¤ëª¨ë‹ˆí„°ë§',
            themeColor: '#0ea5e9'
        },
        'login.kaitrust.ai': {
            title: 'ë¡œê·¸ì¸ | KAITRUST',
            description: 'KAITRUST íšŒì› ë¡œê·¸ì¸. AI ì»´í”Œë¼ì´ì–¸ìŠ¤ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”.',
            keywords: 'KAITRUSTë¡œê·¸ì¸,íšŒì›ë¡œê·¸ì¸',
            themeColor: '#3b82f6'
        },
        'medical.kaitrust.ai': {
            title: 'ì˜ë£Œ AI ì»´í”Œë¼ì´ì–¸ìŠ¤ | KAITRUST',
            description: 'ì˜ë£ŒÂ·í—¬ìŠ¤ì¼€ì–´ AI ê·œì œ ëŒ€ì‘ ì „ë¬¸. SaMD, ì˜ë£Œê¸°ê¸° ì¸í—ˆê°€ ì§€ì›.',
            keywords: 'ì˜ë£ŒAI,í—¬ìŠ¤ì¼€ì–´AI,SaMD,ì˜ë£Œê¸°ê¸°AI',
            themeColor: '#06b6d4'
        },
        'finance.kaitrust.ai': {
            title: 'ê¸ˆìœµ AI ì»´í”Œë¼ì´ì–¸ìŠ¤ | KAITRUST',
            description: 'ê¸ˆìœµê¶Œ AI ê·œì œ ì „ë¬¸. ì‹ ìš©í‰ê°€, ìžì‚°ìš´ìš©, ë³´í—˜ AI ëŒ€ì‘.',
            keywords: 'ê¸ˆìœµAI,í•€í…Œí¬,AIì‹ ìš©í‰ê°€',
            themeColor: '#eab308'
        }
    };

    // Initialize
    init();

    function init() {
        // Wait for DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', onReady);
        } else {
            onReady();
        }
    }

    function onReady() {
        console.log(`ðŸš€ KAITRUST Site Kit v${VERSION} initializing...`);

        // Enhance SEO first (synchronous)
        enhanceSEO();

        // Load components (async)
        loadComponents();

        console.log(`âœ… KAITRUST Site Kit v${VERSION} loaded`);
    }

    function enhanceSEO() {
        const hostname = window.location.hostname;
        const seo = SEO_DATA[hostname] || SEO_DATA['kaitrust.ai'];
        const currentUrl = window.location.href;

        // Don't override if already set
        const head = document.head;

        // Open Graph
        addMetaIfMissing('og:type', 'website', 'property');
        addMetaIfMissing('og:site_name', 'KAITRUST í•œêµ­ì¸ê³µì§€ëŠ¥ì§„í¥í˜‘íšŒ', 'property');
        addMetaIfMissing('og:title', seo.title, 'property');
        addMetaIfMissing('og:description', seo.description, 'property');
        addMetaIfMissing('og:image', seo.image || 'https://kaitrust.ai/og-image.png', 'property');
        addMetaIfMissing('og:url', currentUrl, 'property');
        addMetaIfMissing('og:locale', 'ko_KR', 'property');

        // Twitter Card
        addMetaIfMissing('twitter:card', 'summary_large_image', 'name');
        addMetaIfMissing('twitter:title', seo.title, 'name');
        addMetaIfMissing('twitter:description', seo.description, 'name');
        addMetaIfMissing('twitter:image', seo.image || 'https://kaitrust.ai/og-image.png', 'name');

        // Mobile Web App
        addMetaIfMissing('theme-color', seo.themeColor || '#3b82f6', 'name');
        addMetaIfMissing('apple-mobile-web-app-capable', 'yes', 'name');
        addMetaIfMissing('apple-mobile-web-app-status-bar-style', 'black-translucent', 'name');
        addMetaIfMissing('apple-mobile-web-app-title', 'KAITRUST', 'name');

        // Additional SEO
        addMetaIfMissing('robots', 'index, follow', 'name');
        addMetaIfMissing('author', 'í•œêµ­ì¸ê³µì§€ëŠ¥ì§„í¥í˜‘íšŒ', 'name');

        // Canonical URL
        if (!document.querySelector('link[rel="canonical"]')) {
            const canonical = document.createElement('link');
            canonical.rel = 'canonical';
            canonical.href = currentUrl.split('?')[0]; // Remove query params
            head.appendChild(canonical);
        }

        // JSON-LD Structured Data
        addStructuredData(seo);
    }

    function addMetaIfMissing(key, value, type) {
        const selector = type === 'property'
            ? `meta[property="${key}"]`
            : `meta[name="${key}"]`;

        if (!document.querySelector(selector)) {
            const meta = document.createElement('meta');
            meta.setAttribute(type, key);
            meta.content = value;
            document.head.appendChild(meta);
        }
    }

    function addStructuredData(seo) {
        // Check if already exists
        if (document.querySelector('script[type="application/ld+json"]')) return;

        const hostname = window.location.hostname;
        const isMainSite = hostname === 'kaitrust.ai' || hostname === 'www.kaitrust.ai';

        const structuredData = {
            '@context': 'https://schema.org',
            '@type': isMainSite ? 'Organization' : 'WebSite',
            'name': isMainSite ? 'í•œêµ­ì¸ê³µì§€ëŠ¥ì§„í¥í˜‘íšŒ' : seo.title.split('|')[0].trim(),
            'url': window.location.origin,
            'description': seo.description,
            'logo': 'https://kaitrust.ai/favicon.png'
        };

        if (isMainSite) {
            structuredData['@type'] = 'Organization';
            structuredData['sameAs'] = [
                'https://wiastandards.com'
            ];
            structuredData['contactPoint'] = {
                '@type': 'ContactPoint',
                'telephone': '+82-70-7101-7878',
                'contactType': 'customer service',
                'availableLanguage': ['Korean', 'English']
            };
            structuredData['address'] = {
                '@type': 'PostalAddress',
                'streetAddress': 'ë§ˆê³¡ì¤‘ì•™6ë¡œ 21, 507í˜¸ D14',
                'addressLocality': 'ì„œìš¸íŠ¹ë³„ì‹œ',
                'addressRegion': 'ê°•ì„œêµ¬',
                'postalCode': '07793',
                'addressCountry': 'KR'
            };
        }

        const script = document.createElement('script');
        script.type = 'application/ld+json';
        script.textContent = JSON.stringify(structuredData);
        document.head.appendChild(script);
    }

    function loadComponents() {
        // Sort by priority
        const sorted = COMPONENTS.sort((a, b) => a.priority - b.priority);

        sorted.forEach(component => {
            // Load CSS first
            if (component.css) {
                loadCSS(BASE_PATH + component.css);
            }

            // Load JS
            loadJS(BASE_PATH + component.js);
        });
    }

    function loadCSS(href) {
        // Check if already loaded
        if (document.querySelector(`link[href="${href}"]`)) return;

        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        document.head.appendChild(link);
    }

    function loadJS(src) {
        // Check if already loaded
        if (document.querySelector(`script[src="${src}"]`)) return;

        const script = document.createElement('script');
        script.src = src;
        script.async = true;
        document.body.appendChild(script);
    }

    // Expose global API
    window.KaitrustSiteKit = {
        version: VERSION,
        reload: function() {
            loadComponents();
        },
        getSEO: function() {
            return SEO_DATA[window.location.hostname] || SEO_DATA['kaitrust.ai'];
        }
    };

})();
